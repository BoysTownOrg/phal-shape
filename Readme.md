# Overview
_phal-shape_ is a repository of MATLAB code cited in the article, "Shape and sound analyses of the human ear canal geometry," by Douglas H. Keefe, Heather L. Porter, and Denis F. Fitzpatrick, which is published in J. Acoust. Soc. Am. XX, XX-XX, 2025. 

## _Purpose of code_

The input to the code is a Surface Triangle Language (STL) file that digitally encodes the wall-boundary surface of the ear canal and other structures of the external ear. The code voxelizes the data in the STL file to enable numerical analyses of the shape of the ear-canal surface in 3D space. The other external-ear structures (such as the concha and cymba) are removed from the image using manual steps in the MATLAB Image Processing Toolkit so as to obtain an image of ear-canal shape alone, which is saved as a MATLAB MAT file. This MAT file is an input to the code to calculate the 3D geometry of the curved ear canal. The geometry is modeled by calculating the curved centerline of the canal from the entrance to more medial points, and then fitting each 2D slice of image data by a model ellipse. The 1D curved centerline is parameterized by its curvature and torsion in 3D space. Please refer to the article referenced above for further information. 

## _Contents of folders_

- _STLAnalysis_JASA_: to run the code in this folder, add it and it's subfolders to the Matlab path.
    - Shape_Part1.m - requires the Image Processing Toolbox from Mathworks. Gridtrimesh was obtained from matlabcentral fileexchange (https://www.mathworks.com/matlabcentral/fileexchange/14646-gridtrimesh). 
        - code to analyze ear-canal shape based on reading a STL file from a digital scan of the outer ear and ear canal. See comment in code for additional details.
            - At some point, the Matlab volumeSegmenter app will open. Please read comments in the file do12_JASA.m in the utilities folder beginning on line 107 for detailed instructions. Also refer to official Matlab documentation for the app.
    - Shape_Part2.m - requires the Image Processing Toolbox and Curve Fitting Toolbox from Mathworks
        - This script analyses the ear-canal shape functions including area function, eccentricity, curvature, and torsion. It reads a MAT file with individual ear shape data saved by Shape_Part1. See comment in code for additional details.
- STLs_JASA 
    - STL (stereolithography) files output by the handheld scanner. These provide the raw data for further analysis. The relevant fields in the file A001_Ax_002R_20210414_1030_training.training_L3DS-19-0043_5.2.0.801_Mo1.stl are the first one (A001) which give the subject ID, and the third field (002R), the last letter of which indicates the ear.

- _matFiles_JASA_
    This empty folder holds any MAT files saved by the user of the code.


- _PDF_JASA_
    - Folder which will contain output generated by Shape_Part1.m
