# Overview
_phal-shape_ is a repository of MATLAB code (MathWorks.com) cited in the article, "Shape and sound analyses of the human ear canal geometry," by Douglas H. Keefe, Heather L. Porter, and Denis F. Fitzpatrick, which is published in J. Acoust. Soc. Am. XX, XX-XX, 2025. 

The input to the code is a Surface Triangle Language (STL) file that digitally encodes the wall-boundary surface of the ear canal and other structures of the external ear. The code voxelizes the data in the STL file to enable numerical analyses of the shape of the ear-canal surface in 3D space. The other external-ear structures (such as the concha and cymba) are manually edited by the from the image so as to obtain an image of ear-canal shape alone, which is saved as a MATLAB MAT file. This MAT file is an input to the code to calculate the 3D geometry of the curved ear canal. The geometry is modeled by calculating the curved centerline of the canal from the entrance to more medial points, and then fitting each 2D slice of image data by a model ellipse. The 1D curved centerline is parameterized by its curvature and torsion in 3D space. Please refer to the published article for further information. 

# _Folder of MATLAB code_

- _STLAnalysis_JASA_: to run this MATLAB code, add it and its subfolders to the MATLAB path. Other MATLAB code is found in the _Utilities_ subfolder.
    - The script _Shape_Part1.m_ for Part 1 of the code requires the Image Processing Toolbox from the MathWorks. The code in subfolder _gridtrimesh_ was obtained from matlabcentral fileexchange (https://www.mathworks.com/matlabcentral/fileexchange/14646-gridtrimesh). 
        - code to analyze ear-canal shape based on reading a STL file from a digital scan of the external ear and ear canal. See comments in code for additional details.
            - The Matlab _volumeSegmenter_ app is used in an intermediate processing step. Please refer to comments in the file _Utilities/do12_JASA.m_ beginning on line 107 for detailed instructions on how to use this app. Also refer to official Matlab documentation for the app.
            - The outputs from this script are: (1) a MAT file (saved in folder _matFiles_JASA_) that stores the imaging results from processing the input STL file, and (2) a multi-page PDF file (saved in _PDF_JASA_) that waves the contents of each MATLAB figure generated by _Shape_Part1.m_.  When the user runs An intermediate stored output is a _labels.mat_ file saved by the _volumeSegmenter_ app (as described in the code comments).              
    - The script _Shape_Part2.m_ for Part 2 of the code requires the Curve Fitting Toolbox from the MathWorks. The input to Part 2 is one of the MAT files in the folder _matFiles_JASA_. Part 2 analyses the ear-canal shape functions including area function, eccentricity, curvature, and torsion.  See comment in code for additional details.

# _Date Folders_
- _STLs_JASA_: contains the STL files acquired for each test ear. The relevant fields in each named file, e.g., A001_Ax_002R_20210414_1030_training.training_L3DS-19-0043_5.2.0.801_Mo1.stl, include the first field (A001) which gives the subject identifier, and the last letter of the third field (002R), which is either an R for the right ear or L for the left ear.

- _matFiles_JASA_: contains the MATLAB MAT files analyzed for each test ear, as obtained by the authors from each respective STL file. Any MAT file saved by _Shape_Part1.m_ of ear results over-writes the MAT file of the same name in this folder. Users may wish to archive the original set of MAT files in this folder stored on Github.

- _PDF_JASA_: This empty folder in the repository will hold any PDF file generated by Shape_Part1.m.
